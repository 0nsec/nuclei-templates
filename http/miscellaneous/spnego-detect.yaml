id: spnego-detect

info:
  name: SPNEGO - Detect
  author: lady_bug,ruppde
  severity: info
  description: |
    SPNEGO stands for Simple and Protected GSSAPI Negotiation Mechanism. It is a protocol used for secure authentication and negotiation between client and server applications in a network environment. SPNEGO is based on the Generic Security Services Application Programming Interface (GSSAPI) framework.
  reference:
    - https://www.ibm.com/docs/en/was-liberty/core?topic=authentication-single-sign-http-requests-using-spnego-web
    - https://arstechnica.com/information-technology/2022/12/critical-windows-code-execution-vulnerability-went-undetected-until-now/
  metadata:
    verified: true
    max-request: 1
    shodan-query: 'www-authenticate: negotiate'
  tags: miscellaneous,misc,windows,spnego

http:
  - method: GET
    path:
      - "{{BaseURL}}"

    host-redirects: true
    max-redirects: 5

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "contains(tolower(header), 'www-authenticate: negotiate')"

    extractors:
      - type: kval
        kval:
          - 'www_authenticate'
# digest: 4a0a00473045022065d18914e181aaa87aa5713a6d423568cc9805c705df141cc87f43573fd1259d022100b6c71381dd049636bf8557cb7d63ed0f7ec685117045fb0fc9919a04da8b13fb:922c64590222798bb761d5b6d8e72950