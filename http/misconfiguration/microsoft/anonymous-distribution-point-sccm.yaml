id: anonymous-distribution-point-sccm

info:
  name: Microsoft SCCM - Anonymous Distribution Point Access
  author: matejsmycka
  severity: medium
  description: |
    Microsoft System Center Configuration Manager (SCCM) can be configured to allow anonymous access to its distribution points.
    This can lead to sensitive data exposure and information gathering by unauthorized users. 
    This misconfiguration is exploitable only via HTTP.
  reference:
    - https://www.synacktiv.com/en/publications/sccmsecretspy-exploiting-sccm-policies-distribution-for-credentials-harvesting-initial
    - https://github.com/badsectorlabs/sccm-http-looter
    - https://learn.microsoft.com/en-us/intune/configmgr/core/servers/deploy/configure/install-and-configure-distribution-points
  tags: misconfig,microsoft,sccm,anonymous,distribution-point,http

http:
  - method: GET
    path:
      - "{{BaseURL}}/SMS_DP_SMSPKG$/Datalib"
      - "{{BaseURL}}:80/SMS_DP_SMSPKG$/Datalib"
  
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "/SMS_DP_SMSPKG\\$/Datalib/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"

      - type: status
        status:
          - 200