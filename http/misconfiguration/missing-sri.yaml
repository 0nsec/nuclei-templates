id: missing-sri

info:
  name: Missing Subresource Integrity
  author: lucky0x0d,PulseSecurity.co.nz,sullo
  severity: info
  description: |
    Checks if script tags within the HTML response have Subresource Integrity implemented via the integrity attribute.
  reference:
    - https://cheatsheetseries.owasp.org/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html#subresource-integrity
    - https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity
  metadata:
    max-request: 1
  tags: compliance,js,sri,misconfig

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

    redirects: true
    max-redirects: 5

    matchers-condition: and
    matchers:
      - type: xpath
        part: body
        xpath:
          - "//script[contains(@src,'//') and not(matches(translate(@integrity,'ABCDEFGHIJKLMNOPQRSTUVWXYZ+/-=','abcdefghijklmnopqrstuvwxyz+/-='), '^sha(256|384|512)-'))]"

      - type: word
        words:
          - "text/html"
        part: header

    extractors:
      - type: xpath
        attribute: src
        xpath:
          - "//script[contains(@src,'//') and not(matches(translate(@integrity,'ABCDEFGHIJKLMNOPQRSTUVWXYZ+/-=','abcdefghijklmnopqrstuvwxyz+/-='), '^sha(256|384|512)-'))]"
# digest: 4a0a00473045022100d659bb4fd0b90822563d895de009cde27f64e020a1e45299695da169a0f5e8a00220648bd34423d01efe65e63b6c5c122fa3a2853b8356608f6c4dae3ed2b659885c:922c64590222798bb761d5b6d8e72950