id: elasticsearch

info:
  name: ElasticSearch Information Disclosure
  author: Shine,c-sh0,geeknik
  severity: low
  description: Internal information is exposed in elasticsearch to external users.
  classification:
    cpe: cpe:2.3:a:elasticsearch:elasticsearch:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 4
    vendor: elasticsearch
    product: elasticsearch
    shodan-query: "ElasticSearch"
  tags: elastic,unauth,elasticsearch,misconfig

http:
  - method: GET
    path:
      - '{{BaseURL}}/?pretty'
      - '{{BaseURL}}/_cat/indices?v'
      - '{{BaseURL}}/_all/_search'
      - "{{BaseURL}}/_cluster/health?pretty"

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: word
        words:
          - '"took":'
          - '"number" :'
          - '"number_of_nodes"'
        condition: or

      - type: word
        part: header
        words:
          - application/json
          - application/vnd.api+json
          - text/plain
        condition: or

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '"number"\s:\s"([0-9.]+)"'
# digest: 4a0a004730450220772fcd4d4e0c5afcfae36eb21bc3d3b3d9f6a4f107ca0f388f7e56eadcc60ac3022100a02ff0cbbde5807c80c000861d549f1c1558d7c1dc271a804a2aa2b2eede40ef:922c64590222798bb761d5b6d8e72950