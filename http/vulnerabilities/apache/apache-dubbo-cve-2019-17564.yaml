id: apache-dubbo-cve-2019-17564

info:
  name: Apache Dubbo 2.5.x-2.7.4 - Insecure Deserialization (CVE-2019-17564)
  author: Khalid6468
  severity: critical
  description: |
    Apache Dubbo versions 2.7.0 to 2.7.4, 2.6.0 to 2.6.7, and all 2.5.x versions contain an insecure deserialization vulnerability.
    The vulnerability allows attackers to send malicious Java objects via HTTP POST requests, potentially leading to remote code execution
    and full compromise of the Provider instance when HTTP is enabled.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-17564
    - https://github.com/fairyming/CVE-2019-17564
    - https://github.com/Dor-Tumarkin/CVE-2019-17564-FastJson-Gadget
    - https://github.com/Exploit-3389/CVE-2019-17564
    - https://github.com/Hu3sky/CVE-2019-17564
    - https://github.com/Jaky5155/CVE-2019-17564
    - https://github.com/r00t4dm/CVE-2019-17564
    - https://dubbo.apache.org/en/docs3-v2/java-sdk/advanced-features-and-usage/security/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-502
  metadata:
    max-request: 2
    verified: true
    fofa-query: app="APACHE-dubbo"
    kev: true
  tags: cve,cve2019,dubbo,apache,deserialization,rce,kev,critical

http:
  - method: POST
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/dubbo"
      - "{{BaseURL}}/dubbo/"
    headers:
      Content-Type: application/x-www-form-urlencoded
      User-Agent: Mozilla/5.0 (compatible; Nuclei)
    body: |
      interface=com.example.TestService&method=test&parameterTypes=java.lang.String&parameter=rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAAAA=

    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "java.lang.ClassNotFoundException"
          - "java.io.InvalidClassException"
          - "java.lang.ClassCastException"
          - "java.io.StreamCorruptedException"
          - "java.lang.NullPointerException"
        condition: or

      - type: word
        part: header
        words:
          - "java.lang.ClassNotFoundException"
          - "java.io.InvalidClassException"
          - "java.lang.ClassCastException"
          - "java.io.StreamCorruptedException"
        condition: or

      - type: status
        status:
          - 500
          - 400

    extractors:
      - type: regex
        part: body
        regex:
          - "java\\.lang\\..*Exception"
          - "java\\.io\\..*Exception" 