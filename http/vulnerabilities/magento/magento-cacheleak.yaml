id: magento-cacheleak

info:
  name: Magento Cacheleak
  author: TechbrunchFR
  severity: high
  description: Magento Cacheleak is an implementation vulnerability, result of bad implementation of web-server configuration for Magento platform. Magento was developed to work under the Apache web-server which natively works with .htaccess files, so all needed configuration directives specific for various internal Magento folders were placed in .htaccess files.  When Magento is installed on web servers that are ignoring .htaccess files (such as nginx), an attacker can get access to internal Magento folders (such as the Magento cache directory) and extract sensitive information from cache files.
  reference:
    - https://support.hypernode.com/en/best-practices/security/how-to-secure-magento-cacheleak
    - https://www.acunetix.com/vulnerabilities/web/magento-cacheleak/
    - https://royduineveld.nl/magento-cacheleak-exploit/
  classification:
    cpe: cpe:2.3:a:magento:magento:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: magento
    product: magento
    shodan-query: http.component:"Magento"
  tags: magento

http:
  - method: GET
    path:
      - '{{BaseURL}}/var/resource_config.json'

    # Based on royduineveld.nl blogpost, was not tested against a vulnerable Magento site
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "media_directory"
          - "allowed_resources"
        part: body

      - type: word
        words:
          - "application/json"
        part: header
# digest: 4b0a00483046022100e1aa993f6149d4f04bacde1a22239dbac57d3d9766c2e5781516004004d47daf022100938f1f2ab11ad161bb22ebb945a568b1ec0a518e0b7e7e707092eeb457b10c05:922c64590222798bb761d5b6d8e72950