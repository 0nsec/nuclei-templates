id: adcs-certificate

info:
  name: Certification Authority Web Enrollment (ADCS) - Detection
  author: pastaga,defte
  severity: info
  description: |
    Web Enrollment is a service that can be installed on an AD CS server to allow users and computers in an Active Directory domain to request a certificate through an interactive web page.
  metadata:
    verified: true
    shodan-query: html:"/certenroll"
  tags: ad,adcs,exposure,files

http:
  - method: GET
    path:
      - "{{BaseURL}}/certenroll/"
      - "{{BaseURL}}/CertEnroll/"

    host-redirects: true
    matchers:
      - type: dsl
        dsl:
          - contains(body, ".crl") || contains(body, ".crt")
          - contains(body, "CertEnroll") || contains(body, "certenroll")
          - status_code == 200
        condition: and
# digest: 4a0a00473045022100b43cf6432091e93d776f0cd8d3711bb5ad17d76d1e6b8fa20865f275eb7823a40220584111b3b006e5b62a3ded6722ac75ec6ccd474475e046f7211944be3a1fed7a:922c64590222798bb761d5b6d8e72950