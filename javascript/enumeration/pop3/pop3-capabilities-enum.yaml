id: pop3-capabilities-enum

info:
  name: POP3 Capabilities - Enumeration
  author: pussycat0x,daffainfo
  severity: info
  description: |
    POP3 capabilities are defined in RFC 2449. The CAPA command allows a client to ask a server what commands it supports and possibly any site-specific policy. Besides the list of supported commands, the IMPLEMENTATION string giving the server version may be available.
  reference:
    - https://nmap.org/nsedoc/scripts/pop3-capabilities.html
  metadata:
    verified: true
    max-request: 1
    shodan-query: "port:110"
  tags: js,network,pop3,enum

javascript:
  - pre-condition: |
      isPortOpen(Host,Port);
    code: |
      let data = "CAPA\r\n"
      let c = require("nuclei/net");
      let conn = c.Open('tcp', `${Host}:${Port}`);
      conn.Send(data);
      let result = conn.RecvString();
      Export(result);

    args:
      Host: "{{Host}}"
      Port: 110

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "success == true"

      - type: regex
        regex:
          - '\+OK.*'

      - type: word
        words:
          - "HTTP/1.1"
        negative: true

    extractors:
      - type: dsl
        dsl:
          - replace_regex(replace_regex(response, "\\+OK.*\\r\\n\\+OK.*\\r\\n", ""), "\\r\\n", " ")
# digest: 4a0a00473045022100e80edd82460a44ef1cad9e5a8e06feea944c4e4c0ab5b992b96348b3b93bba6602201f746b06b79dd14c2b25f6639f37a28a4462b57ef4ea6009491d0bb1d60d01bc:922c64590222798bb761d5b6d8e72950