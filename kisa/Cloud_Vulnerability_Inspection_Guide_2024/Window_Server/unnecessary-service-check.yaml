id: unnecessary-service-check

info:
  name: Unnecessary Service Removal Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: |
    Verify that unnecessary services (Alerter, Clipbook, Messenger, Simple TCP/IP Services) are not running.
    These services, if active, may expose the system to security risks.
  impact: |
    Running these services can provide attackers with a means to exploit the system, as they are known to be vulnerable.
  remediation: |
    Stop and disable these services using:
    > net stop [ServiceName]
    > sc config [ServiceName] start= disabled
    or via the Services management console.
  tags: service-management,windows,code,windows-audit,kisa

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $servicesToCheck = @("Alerter", "Clipbook", "Messenger", "Simple TCP/IP Services")
      $vulnerable = $false
      foreach ($svc in $servicesToCheck) {
          $service = Get-Service -Name $svc -ErrorAction SilentlyContinue
          if ($service -and $service.Status -eq "Running") {
              $vulnerable = $true
              break
          }
      }
      if ($vulnerable) {
          "UNNECESSARY_SERVICE_RUNNING"
      } else {
          "UNNECESSARY_SERVICE_STOPPED"
      }

    matchers:
      - type: word
        words:
          - "UNNECESSARY_SERVICE_RUNNING"