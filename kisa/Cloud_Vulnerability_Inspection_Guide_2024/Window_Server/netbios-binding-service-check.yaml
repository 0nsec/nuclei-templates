id: netbios-binding-service-check

info:
  name: NetBIOS Binding Service Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: Verify that TCP/IP and NetBIOS binding is removed by ensuring that the NetbiosOptions registry value is set to 2.
  impact: |
    If TCP/IP and NetBIOS binding are not removed, attackers may exploit the exposed file system and other resources.
  remediation: |
    Disable NetBIOS over TCP/IP by setting the NetbiosOptions registry value to 2 in:
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NetBT\Parameters\Interfaces.
  tags: windows, netbios, network, security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $regPath = 'HKLM:\SYSTEM\CurrentControlSet\Services\NetBT\Parameters\Interfaces'
      $interfaces = Get-ChildItem -Path $regPath -ErrorAction SilentlyContinue
      $vulnerable = $false
      foreach ($interface in $interfaces) {
          $netbiosOption = (Get-ItemProperty -Path $interface.PSPath -Name NetbiosOptions -ErrorAction SilentlyContinue).NetbiosOptions
          if ($netbiosOption -ne 2) {
              $vulnerable = $true
              break
          }
      }
      if ($vulnerable) {
          "NETBIOS_BINDING_NOT_REMOVED"
      } else {
          "NETBIOS_BINDING_REMOVED"
      }
    matchers:
      - type: word
        words:
          - "NETBIOS_BINDING_NOT_REMOVED"