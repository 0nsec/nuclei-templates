id: password-cleartext-encryption

info:
  name: Store Passwords Using Reversible Encryption Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: Verify that the policy "Store passwords using reversible encryption" is disabled. If enabled, it may allow retrieval of plaintext passwords.
  impact: |
    If enabled, attackers can potentially exploit this setting to recover user passwords, thereby compromising network resources.
  remediation: |
    Disable this policy via:
    - CLI: Edit the exported configuration to set ClearTextPassword=0 and apply using secedit.
    - GUI: Local Security Policy → Account Policies → Password Policy → "Store passwords using reversible encryption" → set to Disabled.
  tags: windows, account-management, password-policy

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      # Export security settings to a configuration file
      secedit /export /cfg C:\cfg.txt | Out-Null
      $cfg = Get-Content C:\cfg.txt | Out-String
      if ($cfg -match "ClearTextPassword\s*=\s*(\d)") {
          $value = $Matches[1]
          if ($value -eq "1") {
              "CLEAR_TEXT_PASSWORD_ENABLED"
          } else {
              "CLEAR_TEXT_PASSWORD_DISABLED"
          }
      } else {
          "CLEAR_TEXT_PASSWORD_NOT_FOUND"
      }
    matchers:
      - type: word
        words:
          - "CLEAR_TEXT_PASSWORD_ENABLED"
# digest: 4a0a0047304502206eb5bd925a3babc3cc8b0af70d2a31e7b5384d5d3d84a71b577302240c336ae2022100f56f505d54754f0a82d478aae23a2103f10adf28bb6e0fa17ca945d76f347d26:3bd7ba8113bb8138bfd3703bfad1917a