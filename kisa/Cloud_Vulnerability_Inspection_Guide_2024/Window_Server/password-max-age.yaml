id: password-max-age

info:
  name: Password Maximum Age Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: |
    Verify that the maximum password age is set to 90 days or less. If the maximum password age exceeds 90 days or is not set,
    there is an increased risk of password compromise due to prolonged usage.
  impact: |
    Longer password usage increases the risk of password leakage and brute-force attacks.
  remediation: |
    Configure the maximum password age via:
    > net accounts /MAXPWAGE:90
    or through Local Security Policy settings.
  tags: windows,account-management,password,security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      # Export security settings to a configuration file
      secedit /export /cfg C:\cfg.txt | Out-Null
      $content = Get-Content C:\cfg.txt | Out-String
      if ($content -match "MaximumPasswordAge\s*=\s*(\d+)") {
          $maxAge = [int]$Matches[1]
          if ($maxAge -gt 90) {
              "PASSWORD_MAX_AGE_EXCEEDS_LIMIT"
          } else {
              "PASSWORD_MAX_AGE_OK"
          }
      } else {
          "PASSWORD_MAX_AGE_NOT_SET"
      }
    matchers:
      - type: word
        words:
          - "PASSWORD_MAX_AGE_EXCEEDS_LIMIT"
          - "PASSWORD_MAX_AGE_NOT_SET"
        condition: or
# digest: 4a0a00473045022100ba6876e727246ada2b8e1b8b92887f5a6e13eca19397c830b27cbef4813cf15302205964071abde6c4855cbd4535b0eea011858fda0a3b8a291f277050f53eb682c2:3bd7ba8113bb8138bfd3703bfad1917a