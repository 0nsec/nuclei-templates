id: ftp-service-check

info:
  name: FTP Service Running Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: Verify that the FTP service (ftpsvc) is not running, as its operation transmits credentials unencrypted, making them vulnerable to sniffing attacks.
  impact: |
    If the FTP service is running, attackers may capture clear-text credentials via simple network sniffing tools.
  remediation: |
    Disable the FTP service by executing:
    > net stop ftpsvc
    > sc config ftpsvc start= disabled
    or disable it via the Services management console.
  tags: windows, ftp, service, security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $ftpService = Get-Service -Name ftpsvc -ErrorAction SilentlyContinue
      if ($ftpService -and $ftpService.Status -eq "Running") {
          "FTP_SERVICE_RUNNING"
      } else {
          "FTP_SERVICE_NOT_RUNNING"
      }
    matchers:
      - type: word
        words:
          - "FTP_SERVICE_RUNNING"