id: autologon-control

info:
  name: Autologon Function Control Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: |
    Verify that the Autologon feature is disabled by checking that the AutoAdminLogon registry value in
    HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon is either absent or set to "0". If set to "1",
    login credentials may be stored in the registry, posing a security risk.
  impact: |
    When Autologon is enabled, attackers with physical or remote access could retrieve stored login credentials,
    leading to unauthorized access.
  remediation: |
    Disable Autologon by setting the AutoAdminLogon registry value to "0". This can be done via:
    - Registry Editor: Navigate to HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon and set AutoAdminLogon to "0".
  tags: windows, autologon, registry, security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $regPath = "HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"
      $autologon = (Get-ItemProperty -Path $regPath -Name AutoAdminLogon -ErrorAction SilentlyContinue).AutoAdminLogon
      if ($null -eq $autologon -or $autologon -eq "0") {
          "AUTO_ADMIN_LOGON_DISABLED"
      } else {
          "AUTO_ADMIN_LOGON_ENABLED"
      }
    matchers:
      - type: word
        words:
          - "AUTO_ADMIN_LOGON_ENABLED"
# digest: 4b0a00483046022100b21a9a8ff49de27080bb996fb38e70e565779d0bfd61432979c061f85152eef3022100f6108d2d823f98ecac71675a578c29b6a5cbe00d5e72a82b21a387ff5802b186:3bd7ba8113bb8138bfd3703bfad1917a