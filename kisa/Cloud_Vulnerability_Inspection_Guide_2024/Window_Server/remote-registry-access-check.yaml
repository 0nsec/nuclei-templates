id: remote-registry-access-check

info:
  name: Remote Registry Service Disabled Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: |
    Verify that the Remote Registry Service is disabled to prevent remote access to the Windows registry.
    Remote access to the registry can allow unauthorized modifications and compromise system security.
  impact: |
    If the Remote Registry Service is running, attackers with administrative privileges may remotely access and alter registry settings,
    increasing the risk of system compromise.
  remediation: |
    Disable the Remote Registry Service by setting its startup type to "Disabled" (registry Start value 4) either via:
    - Registry: Modify HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RemoteRegistry (set Start=4)
    - Services: Set the Remote Registry service startup type to "Disabled" and stop the service.
  tags: windows, registry, remote-access, security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $remoteRegistry = Get-Service -Name RemoteRegistry -ErrorAction SilentlyContinue
      if ($remoteRegistry -and $remoteRegistry.Status -eq "Running") {
          "REMOTE_REGISTRY_ENABLED"
      } else {
          "REMOTE_REGISTRY_DISABLED"
      }
    matchers:
      - type: word
        words:
          - "REMOTE_REGISTRY_ENABLED"
# digest: 490a0046304402201bfaf1323450365a672ac045c2bed55ac1ca7cb6e5b615d0a3b2c79f3673115e0220634c592a1c8b1efc65316554a906f44ad975bcabee59d961b459cd9c53ee620c:3bd7ba8113bb8138bfd3703bfad1917a