id: remote-registry-access-check

info:
  name: Remote Registry Service Disabled Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: |
    Verify that the Remote Registry Service is disabled to prevent remote access to the Windows registry.
    Remote access to the registry can allow unauthorized modifications and compromise system security.
  impact: |
    If the Remote Registry Service is running, attackers with administrative privileges may remotely access and alter registry settings,
    increasing the risk of system compromise.
  remediation: |
    Disable the Remote Registry Service by setting its startup type to "Disabled" (registry Start value 4) either via:
    - Registry: Modify HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RemoteRegistry (set Start=4)
    - Services: Set the Remote Registry service startup type to "Disabled" and stop the service.
  tags: windows,code,windows-audit,kisa,windows,registry,remote-access

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $remoteRegistry = Get-Service -Name RemoteRegistry -ErrorAction SilentlyContinue
      if ($remoteRegistry -and $remoteRegistry.Status -eq "Running") {
          "REMOTE_REGISTRY_ENABLED"
      } else {
          "REMOTE_REGISTRY_DISABLED"
      }

    matchers:
      - type: word
        words:
          - "REMOTE_REGISTRY_ENABLED"