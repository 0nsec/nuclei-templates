id: account-lockout-threshold

info:
  name: Account Lockout Threshold Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: Verify account lockout threshold is set to 5 or fewer attempts to prevent brute-force attacks.
  impact: |
    Missing lockout threshold allows unlimited password guessing attempts, increasing risk of account compromise.
  remediation: |
    Configure lockout threshold via:
    > net accounts /lockoutthreshold:5
    or through Local Security Policy settings.
  tags: windows, account-management, brute-force-protection

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine: 
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      # Registry-based check for language independence
      $regPath = 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System'
      $threshold = (Get-ItemProperty -Path $regPath -Name LockoutBadCount -ErrorAction SilentlyContinue).LockoutBadCount
      
      if ($null -eq $threshold -or $threshold -eq 0) {
          "ACCOUNT_LOCKOUT_THRESHOLD_NOT_SET"
      } elseif ($threshold -gt 5) {
          "ACCOUNT_LOCKOUT_THRESHOLD_EXCEEDS_MAX"
      } else {
          "ACCOUNT_LOCKOUT_THRESHOLD_OK"
      }

    matchers:
      - type: word
        words:
          - "ACCOUNT_LOCKOUT_THRESHOLD_NOT_SET"
          - "ACCOUNT_LOCKOUT_THRESHOLD_EXCEEDS_MAX"
        condition: or