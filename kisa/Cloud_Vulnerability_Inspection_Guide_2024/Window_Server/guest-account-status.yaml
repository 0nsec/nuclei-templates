id: guest-account-status

info:
  name: Guest Account Status Check
  author: nukunga[SungHyunJeon]
  severity: medium
  description: Verify if the built-in Guest account is disabled to prevent unauthorized system access.
  impact: |
    Enabled Guest account allows anonymous access to system resources, increasing attack surface for privilege escalation.
  remediation: |
    Disable Guest account using command:
    > net user guest /active:no
    or via Local Security Policy settings.
  tags: windows, account-management, guest-account, security

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine: 
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - -Bypass
    pattern: "*.ps1"
    source: |
      # Check Guest account by SID (always ends with -501)
      $guestAccount = Get-LocalUser | Where-Object { 
          $_.SID -like '*-501' -and $_.Name -eq 'Guest'
      }
      if ($guestAccount.Enabled -eq $true) {
          "GUEST_ACCOUNT_ENABLED"
      } else {
          "GUEST_ACCOUNT_DISABLED"
      }

    matchers:
      - type: word
        words:
          - "GUEST_ACCOUNT_ENABLED"