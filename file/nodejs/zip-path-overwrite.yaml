id: zip-path-overwrite

info:
  name: Zip Path Overwrite
  author: me_dheeraj (https://twitter.com/Dheerajmadhukar)
  severity: info
  description: Insecure ZIP archive extraction can result in arbitrary path overwrite and can result in code injection.
  tags: file,nodejs
file:
  - extensions:
      - all
    matchers:
      - type: regex
        regex:
          - "require\\('unzip'\\)"
          - "require\\('unzipper'\\)"
          - "[\\w\\W]+?\\.pipe\\([\\w\\W]+?\\.Parse\\([\\w\\W]*?\\)\\)\\.on\\('entry', function [\\w\\W]*?\\([\\w\\W]*?\\) \\{"
          - "[\\w\\W]+? = [\\w\\W]+?\\.indexOf\\([\\w\\W]*?\\)"
          - "[\\w\\W]+?\\.pipe\\([\\w\\W]+?\\.createWriteStream\\([\\w\\W]*?\\)\\)"
          - "[\\w\\W]+?\\.pipe\\([\\w\\W]+?\\.writeFile\\([\\w\\W]*?\\)\\)"
          - "[\\w\\W]+?\\.pipe\\([\\w\\W]+?\\.writeFileSync\\([\\w\\W]*?\\)\\)"
          - "[\\w\\W]+?\\.Parse\\([\\w\\W]*?\\)\\.on\\('entry', function [\\w\\W]*?\\([\\w\\W]*?\\) \\{"
          - "[\\w\\W]+?\\.createWriteStream\\([\\w\\W]*?\\)"
          - "[\\w\\W]+?\\.writeFile\\([\\w\\W]*?\\)"
          - "[\\w\\W]+?\\.writeFileSync\\([\\w\\W]*?\\)"
        condition: or
# digest: 4b0a00483046022100ffbf665d4c2020035ca5c0cce465fa677c8161c2502ffdab1acca5a33f0219ed022100fd55134f1df14bf8f4d9b06acf7a0ceaed57ad52c84eee8f03eed52ce01849f7:922c64590222798bb761d5b6d8e72950