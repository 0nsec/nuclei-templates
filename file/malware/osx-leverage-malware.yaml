id: osx-leverage-malware

info:
  name: OSX Leverage Malware - Detect
  author: daffainfo
  severity: info
  reference: https://github.com/Yara-Rules/rules/blob/master/malware/MALW_OSX_Leverage.yar
  tags: malware,file
file:
  - extensions:
      - all
    matchers:
      - type: word
        part: raw
        words:
          - "ioreg -l | grep \"IOPlatformSerialNumber\" | awk -F"
          - "+:Users:Shared:UserEvent.app:Contents:MacOS:"
          - "rm '/Users/Shared/UserEvent.app/Contents/Resources/UserEvent.icns'"
          - "osascript -e 'tell application \"System Events\" to get the hidden of every login item'"
          - "osascript -e 'tell application \"System Events\" to get the name of every login item'"
          - "osascript -e 'tell application \"System Events\" to get the path of every login item'"
          - "serverVisible \0"
        condition: and
# digest: 4b0a0048304602210094771ee5e1c251c41652b3e8ae23aa0b282ac14f17bb1ffc1262cc295cdaeb8a022100e035d7bafa62f9d74dfa5347138e0795cc2542f19d4d092cefe4c0561453e1e0:922c64590222798bb761d5b6d8e72950