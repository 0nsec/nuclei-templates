id: msmq-detect

info:
  name: MSMQ (Microsoft Message Queuing Service) Remote - Detect
  author: bhutch
  severity: info
  description: Detects remote MSMQ services. Public exposure of this service may be a misconfiguration.
  reference:
    - https://www.shadowserver.org/what-we-do/network-reporting/accessible-msmq-service-report/
    - https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-mqqb/f9bbe350-d70b-4e90-b9c7-d39328653166
    - https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-mqqb/50da7ea1-eed7-41f9-ba6a-2aa37f5f1e92
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-21554
  metadata:
    verified: true
    max-request: 1
    shodan-query: MSMQ
    censys-query: services.service_name:MSMQ
  tags: network,msmq,detect,detection,tcp
tcp:
  - inputs:
      - data: 10c00b004c494f523c020000ffffffff00000200d1587355509195954997b6e611ea26c60789cd434c39118f44459078909ea0fc4ecade1d100300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
        type: hex

    host:
      - "{{Hostname}}"
    port: 1801
    read-size: 2048

    matchers:
      - type: word
        encoding: hex
        words:
          - "105a0b004c494f523c020000ffffffff"
# digest: 4a0a0047304502205682f910b153fc8d430037c881008f1b88f703571ec6b3b85dbc9fb9313e3cbb022100cea8be071cf3123bca0663ac7dc451646b1090823353b76a7ccecf97fba533c4:922c64590222798bb761d5b6d8e72950