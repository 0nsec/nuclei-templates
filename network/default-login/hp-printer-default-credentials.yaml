id: hp-printer-default-admin-login

info:
  name: Hewlett Packard LaserJet Printer Firmware Version 5.8.1.1 - Default Credentials
  author: John Osborn (Summit Security Group, LLC)
  severity: high
  description: HP printers do not use a password when authenticating as the Administrator user by default. This template detects HP printers that allow this administrative login without a password.
  reference: https://h30434.www3.hp.com/t5/Printing-Errors-or-Lights-Stuck-Print-Jobs/What-is-the-user-name-and-password-in-Embedded-Web-Server/td-p/6165417
  tags: hp,printer,network,default-login,misconfig
  metadata:
    verified: true

requests:
  - method: GET
    path:
      - "{{BaseURL}}/hp/device/SignIn/Index"
    headers:
      User-Agent: Mozilla/5.0
      Accept-Encoding: identity

    extractors:
      - type: regex
        name: token
        internal: true
        part: body
        group: 1
        regex:
          - 'id="CSRFToken" name="CSRFToken" value="([^"]+)"'

  - method: POST
    path:
      - "{{BaseURL}}/hp/device/SignIn/Index"
    headers:
      Content-Type: application/x-www-form-urlencoded
      Referer: "{{BaseURL}}/hp/device/SignIn/Index"
      Origin: "{{BaseURL}}"
      User-Agent: Mozilla/5.0
      Accept-Encoding: identity
    body: |
      CSRFToken={{token}}&agentIdSelect=hp_EmbeddedPin_v1&PinDropDown=AdminItem&PasswordTextBox=&signInOk=Sign+In
    cookie-reuse: true
    redirects: true
    max-redirects: 2

    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "User: Administrator"
          - "Sign out"
      - type: regex
        part: header
        regex:
          - 'Set-Cookie: .*session.*'
