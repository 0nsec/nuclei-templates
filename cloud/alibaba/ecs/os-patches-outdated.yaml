id: os-patches-outdated

info:
  name: OS Patches - Outdated
  author: DhiyaneshDK
  severity: medium
  description: |
    Ensure that the latest OS patches for ECS virtual machines (VM) instances are applied in order to mitigate security vulnerabilities and ensure optimal performance and stability.
  reference:
    - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-ECS/apply-latest-os-patches.html
    - https://www.alibabacloud.com/help/en/security-center/user-guide/fix-software-vulnerabilities
  metadata:
    max-request: 1
    verified: true
  tags: cloud,devops,aliyun,alibaba,aliyun-cloud-config,ecs

variables:
  region: "cn-hangzhou"

self-contained: true

code:
  - engine:
      - sh
      - bash
    source: |
      aliyun sas DescribeVulList --Type cve --region $region

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"RaspStatus":'
          - '"Type":'
        condition: and

      - type: word
        part: body
        words:
          - '"TotalCount": 0'
          - '"VulRecords":'
        condition: and
        negative: true

    extractors:
      - type: dsl
        dsl:
          - '" OS Patches are Outdated "'