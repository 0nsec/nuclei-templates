id: azure-storage-table-logging-disabled
info:
  name: Azure Storage Table Logging Not Enabled
  author: princechaddha
  severity: medium
  description: |
    Ensure that Azure Storage Table service logging is enabled for read, write, and delete requests. The Azure Storage Table service stores structured NoSQL data in the cloud, providing a key/attribute store with a schema-less design. Storage logging is performed server-side and allows details for both successful and failed requests to be recorded in the associated storage account.
  impact: |
    Failing to enable logging for the Azure Storage Table service can prevent tracking of successful and failed requests, impacting auditing and troubleshooting capabilities.
  remediation: |
    Enable logging for read, write, and delete requests in the Azure Storage Table service through the Azure portal or using the Azure CLI.
  reference:
    - https://docs.microsoft.com/en-us/azure/storage/tables/table-storage-overview
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config

flow: |
  code(1);
  for (let AccountData of iterate(template.accountList)) {
    AccountData = JSON.parse(AccountData);
    set("name", AccountData.Name);
    code(2);
  }

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      az storage account list --query '[*].{"Name":name}'

    extractors:
      - type: json
        name: accountList
        internal: true
        json:
          - '.[]'

  - engine:
      - sh
      - bash
    source: |
      az storage logging show --services t --account-name "$name" --output json

    matchers:
      - type: word
        words:
          - '"delete": false'
          - '"read": false'
          - '"write": false'
        condition: and

    extractors:
      - type: dsl
        dsl:
          - 'name + " has logging for read, write, delete not enabled"'
# digest: 4b0a00483046022100ed951594f079cd64e542bc7819b2d674ab1ec265fab22c6c65fcf63b2db6bcf2022100ded50fcd7446a8e4f0baba0a4a79e6f9841721816c44de9a3c111ca03f9542ba:366f2a24c8eb519f6968bd8801c08ebe