id: azure-entra-id-guest-users-unmonitored
info:
  name: Azure Entra ID Guest Users Unmonitored
  author: princechaddha
  severity: medium
  description: |
    For a Microsoft Azure business-to-business (B2B) collaboration, each Microsoft Entra ID guest user needs to be associated with a business owner or business process. Ensure that there are no unassociated Microsoft Entra ID guest users within your Microsoft Azure account when there is no need for B2B collaboration.
  impact: |
    Presence of unmonitored Microsoft Entra ID guest users can lead to unauthorized access and potential security risks within the Azure environment.
  remediation: |
    Regularly review and monitor guest users in Microsoft Entra ID to ensure each is associated with a business owner or process. Remove any unnecessary guest user accounts.
  reference:
    - https://docs.microsoft.com/en-us/azure/active-directory/external-identities/
  tags: cloud,devops,azure,microsoft,entra-id,azure-cloud-config

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      az ad user list --query "[?userType=='Guest']" --output json

    matchers:
      - type: word
        words:
          - '"userType": "Guest"'

    extractors:
      - type: dsl
        dsl:
          - '"Azure Account han an Entra ID guest user Microsoft Entra ID"'
# digest: 490a0046304402204015a140c870ff3f4698f2990d7ffd4323338c4facec9bc2fb61d465350ee33802207e7814027dc3823909cda3303b4406c339bad12a2eec25c3efb4fd6a1681fde0:366f2a24c8eb519f6968bd8801c08ebe