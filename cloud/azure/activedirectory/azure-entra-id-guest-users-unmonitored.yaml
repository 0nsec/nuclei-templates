id: azure-entra-id-guest-users-unmonitored
info:
  name: Azure Entra ID Guest Users Unmonitored
  author: princechaddha
  severity: medium
  description: |
    For a Microsoft Azure business-to-business (B2B) collaboration, each Microsoft Entra ID guest user needs to be associated with a business owner or business process. Ensure that there are no unassociated Microsoft Entra ID guest users within your Microsoft Azure account when there is no need for B2B collaboration.
  impact: |
    Presence of unmonitored Microsoft Entra ID guest users can lead to unauthorized access and potential security risks within the Azure environment.
  remediation: |
    Regularly review and monitor guest users in Microsoft Entra ID to ensure each is associated with a business owner or process. Remove any unnecessary guest user accounts.
  reference:
    - https://docs.microsoft.com/en-us/azure/active-directory/external-identities/
  tags: cloud,devops,azure,microsoft,entra-id,azure-cloud-config

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      az ad user list --query "[?userType=='Guest']" --output json

    matchers:
      - type: word
        words:
          - '"userType": "Guest"'

    extractors:
      - type: dsl
        dsl:
          - '"Azure Account han an Entra ID guest user Microsoft Entra ID"'
# digest: 4b0a0048304602210099a5e9b188192c5a07e5e8d4c561b5a059c375456ea1ca155221bf5fdeb9bf9f022100f571e750e66b4529e084e585909a604db79e58d16b5d5f96fcd75980f24f5342:922c64590222798bb761d5b6d8e72950