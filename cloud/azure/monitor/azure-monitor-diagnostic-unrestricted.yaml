id: azure-monitor-diagnostic-unrestricted
info:
  name: Azure Monitor Diagnostic Settings for Subscription Activity Log Export Check
  author: princechaddha
  severity: medium
  description: |
    Ensure that Azure Monitor Diagnostic Settings are configured to export activity logs for the selected Microsoft Azure subscription. This helps in maintaining a record of all operational actions which are crucial for security and operational auditing.
  impact: |
    Not having diagnostic settings configured to export activity logs can lead to a lack of visibility into operational actions within the subscription, increasing the risk of undetected malicious activities or misconfigurations.
  remediation: |
    Configure Azure Monitor Diagnostic Settings to export activity logs. Refer to the Azure documentation on how to set up diagnostic settings for activity log export.
  reference:
    - https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log
  tags: cloud,devops,azure,microsoft,monitor,azure-cloud-config

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      az monitor diagnostic-settings subscription list --query 'value[*].id' --output json

    matchers:
      - type: word
        words:
          - '[]'

    extractors:
      - type: dsl
        dsl:
          - '"Azure Monitor Diagnostic Settings for Subscription Activity Log Export are not configured."'
# digest: 4a0a00473045022100f9cf3d17755a10abbb4a5229e4d4b8b21b377bd97e9d0f2ba251a6fb03f77501022022e0dfa61ebf1c29f7f5f04a3a8259539dfdee2e8fc3ec503870e7250558288f:366f2a24c8eb519f6968bd8801c08ebe