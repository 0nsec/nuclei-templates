id: safe-dll-search-mode-disabled

info:
  name: Safe DLL Search Mode Disabled
  author: princechaddha
  severity: high
  description: Determines if Safe DLL search mode is disabled.
  impact: |
    Disabling Safe DLL search mode may allow attackers to load malicious DLLs from untrusted locations.
  remediation: |
    Enable Safe DLL search mode by setting the SafeDllSearchMode registry key to 1.
  tags: windows,dll,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      $dllSearchMode = Get-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Session Manager' -Name 'SafeDllSearchMode'
      Write-Host "SafeDllSearchMode: $($dllSearchMode.SafeDllSearchMode)"

    matchers:
      - type: word
        words:
          - "SafeDllSearchMode: 0"
# digest: 490a0046304402203ed4176f1fb31970a9cf8f72ed73cc8c347b7cd360f9e2026be6fdac25111a7902200e6e2e16fb38d65d7dec0154cb940274bc64235348ba661d84f1c7f7491fc06c:922c64590222798bb761d5b6d8e72950