id: device-guard-not-configured

info:
  name: Device Guard Not Configured
  author: princechaddha
  severity: high
  description: Verifies if Device Guard is not configured, reducing protection against unauthorized code execution.
  impact: |
    Not configuring Device Guard reduces the system's ability to block unauthorized code execution.
  remediation: |
    Configure Device Guard to enhance system protection.
  tags: device-guard,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard

    matchers:
      - type: regex
        regex:
          - 'SecurityServicesConfigured\s+:\s+\{0\}'
          - 'SecurityServicesRunning\s+:\s+\{0\}'
          - 'VirtualizationBasedSecurityStatus\s+:\s+0'
        condition: or
# digest: 490a0046304402205d98e00824eb31c2ce17c7e5087b106603cdada57edbefc55fccb41b4f2aaecd022034b62f612c5cb6328f1b3607d67b00604b59efe268f21a2303f3caeb028e07f8:922c64590222798bb761d5b6d8e72950