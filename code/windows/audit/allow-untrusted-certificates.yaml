id: allow-untrusted-certificates

info:
  name: System Allows Untrusted Certificates
  author: princechaddha
  severity: medium
  description: Checks if the system allows untrusted certificates to be installed.
  impact: |
    Installing untrusted certificates can lead to man-in-the-middle attacks and data theft.
  remediation: |
    Ensure that untrusted certificates are blocked and only allow trusted certificates to be installed.
  tags: certificates,untrusted,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell
      - powershell.exe
    pattern: "*.ps1"
    source: |
      $certs = Get-ChildItem -Path Cert:\CurrentUser\Disallowed; if ($certs.Count -gt 0) { "Misconfigured certificates detected:`n" + ($certs.Subject -join "`n") } else { "No untrusted certificates detected." }

    matchers:
      - type: word
        words:
          - "Misconfigured certificates detected"

# digest: 4a0a00473045022100885e12a9d20bda232d23d6df1690ec8becc614e10ca2bf653cfb362fab36aed8022058682c9d86fba4b3ced9a2577019e10959685ad498fb35136e9f93359d61dfc0:922c64590222798bb761d5b6d8e72950