id: windows-installer-elevated-privileges

info:
  name: Windows Installer Elevated Privileges Enabled
  author: princechaddha
  severity: medium
  description: Checks if Windows Installer runs with elevated privileges for non-admin users, which could be exploited.
  impact: |
    Elevated privileges for the Windows Installer may allow non-administrative users to install unauthorized software.
  remediation: |
    Disable elevated privileges for non-admin users in Windows Installer settings.
  tags: installer,elevated-privileges,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      if ((Get-ItemProperty -Path 'HKLM:\Software\Policies\Microsoft\Windows\Installer' -Name 'AlwaysInstallElevated' -ErrorAction SilentlyContinue).AlwaysInstallElevated -eq 1) {
        Write-Output 'Installer runs with elevated privileges';
      }

    matchers:
      - type: word
        words:
          - "Installer runs with elevated privileges"
# digest: 4a0a0047304502202769623a017104c95295491a2a7c5899c1489846945670549df26a07343f3741022100a81bd70d71863a49e6ea63d3f8dd4d9e056c26749755caf7b872e4a468240aac:922c64590222798bb761d5b6d8e72950