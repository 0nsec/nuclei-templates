id: windows-installer-elevated-privileges

info:
  name: Windows Installer Elevated Privileges Enabled
  author: princechaddha
  severity: medium
  description: Checks if Windows Installer runs with elevated privileges for non-admin users, which could be exploited.
  impact: |
    Elevated privileges for the Windows Installer may allow non-administrative users to install unauthorized software.
  remediation: |
    Disable elevated privileges for non-admin users in Windows Installer settings.
  tags: installer,elevated-privileges,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      if ((Get-ItemProperty -Path 'HKLM:\Software\Policies\Microsoft\Windows\Installer' -Name 'AlwaysInstallElevated' -ErrorAction SilentlyContinue).AlwaysInstallElevated -eq 1) {
        Write-Output 'Installer runs with elevated privileges';
      }

    matchers:
      - type: word
        words:
          - "Installer runs with elevated privileges"

# digest: 490a00463044022031e0f2215d00e28723ad3b4f8caf487e78ff4a74345616ac21d265b153b8484802205841831cf7337c8d89a0c4a397a72a1fb9427ef9cfb2a89d2337d71e18c0d779:922c64590222798bb761d5b6d8e72950