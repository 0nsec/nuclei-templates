id: privesc-ruby

info:
  name: Ruby - Privilege Escalation
  author: daffainfo
  severity: high
  description: |
    Ruby is a dynamic, open-source programming language known for its simplicity and productivity. It is often used for web development, scripting, and software development. Ruby's elegant syntax and focus on developer happiness have made it a popular choice for building web applications and other software projects.
  reference:
    - https://gtfobins.github.io/gtfobins/ruby/
  metadata:
    verified: true
    max-request: 4
  tags: code,linux,ruby,privesc,local

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      whoami

  - engine:
      - sh
      - bash
    source: |
      ruby -e 'exec "whoami"'

  - engine:
      - sh
      - bash
    source: |
      sudo ruby -e 'exec "whoami"'

  - engine:
      - sh
      - bash
    source: |
      ruby -e 'Process::Sys.setuid(0); exec "whoami"'

    matchers-condition: and
    matchers:
      - type: word
        part: code_1_response
        words:
          - "root"
        negative: true

      - type: dsl
        dsl:
          - 'contains(code_2_response, "root")'
          - 'contains(code_3_response, "root")'
          - 'contains(code_4_response, "root")'
        condition: or
# digest: 4a0a0047304502201f80d43b59635f51f5815250aeb2ea252f0a9e00bbefa15677d0b25828869f69022100e2c8d4baf5b9b5620986f7095fc64cf8ce9dc31bbdc0e48ffcc968876dfefc33:922c64590222798bb761d5b6d8e72950