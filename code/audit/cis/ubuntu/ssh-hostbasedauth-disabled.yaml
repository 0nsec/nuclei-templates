id: ssh-hostbasedauth-disabled
info:
  name: Ensure SSH HostbasedAuthentication is disabled
  author: Th3l0newolf
  severity: high
  description: |
    This template verifies that HostbasedAuthentication is disabled in the SSH configuration.
    HostbasedAuthentication allows authentication based on the host's identity, which can be a security risk
    as it relies on DNS and hostname resolution. As per CIS Ubuntu Linux 24.04 LTS Benchmark,
    this feature should be disabled to prevent potential security vulnerabilities and unauthorized access.
  remediation: Edit /etc/ssh/sshd_config to set 'HostbasedAuthentication no' and restart SSH service with 'sudo systemctl restart sshd'.
  reference:
    - https://www.cisecurity.org/benchmark/ubuntu_linux
  tags: cis,ssh,linux,ssh-audit,ubuntu24.04,benchmark

self-contained: true

code:
  - engine:
      - bash
    args:
      - "-c"
      - |
        SSHD_CONFIG="/etc/ssh/sshd_config"
        # Check if the parameter is set to yes (bad)
        if grep -i '^\s*HostbasedAuthentication\s\+yes' "$SSHD_CONFIG" >/dev/null; then
          current_value=$(grep -i '^\s*HostbasedAuthentication' "$SSHD_CONFIG" | head -1 | tr -d '\n')
          echo "[cis-ssh-hostbasedauth-disabled:Policy-Fail] [$current_value] [CIS_FAIL] [medium]"
        else
          echo "[cis-ssh-hostbasedauth-disabled:Policy-Pass] [HostbasedAuthentication no or not set] [CIS_PASS] [medium]"
        fi

    matchers:
      - type: word
        name: policy-pass
        words:
          - "Policy-Pass"

      - type: word
        name: policy-fail      
        words:
          - "Policy-Fail"
