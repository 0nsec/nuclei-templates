id: dnsmasq-service-check

info:
  name: Ensure dnsmasq Service is Not Installed
  author: Th3l0newolf
  severity: medium
  description: |
    This template checks whether the `dnsmasq` service is installed.
    dnsmasq provides network infrastructure (DNS, DHCP, TFTP) for small networks and should not be present unless explicitly needed.
  remediation: |
    Run: sudo apt-get remove dnsmasq -y
    This removes the dnsmasq package if not required.
  reference:
    - https://www.cisecurity.org/benchmark/ubuntu_linux
  tags: cis,linux,dnsmasq,package,security,audit,ubuntu
  metadata:
    verified: true

self-contained: true

code:
  - engine:
      - bash
    args:
      - "-c"
      - |
        if dpkg-query -s dnsmasq &>/dev/null; then
          echo "[dnsmasq-service-check:Policy-Fail] [dnsmasq is installed] [CIS_FAIL] [medium]"
        else
          echo "[dnsmasq-service-check:Policy-Pass] [dnsmasq is not installed] [CIS_PASS] [medium]"
        fi

    matchers:
      - type: word
        name: policy-pass
        words:
          - "Policy-Pass"

      - type: word
        name: policy-fail
        words:
          - "Policy-Fail"
# digest: 4a0a004730450220620ad2f50d0c27de9a54714996dfe89878d339848552456371804d51fe7fe98e0221009fa1bf0d909029102d2ed760fcacb36824a193ef37989c06ea53f011987dcd06:8d4678b72cd931431edd8f38bb1cef76