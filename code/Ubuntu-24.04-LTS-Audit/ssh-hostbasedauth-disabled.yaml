id: ssh-hostbasedauth-disabled
info:
  name: Ensure SSH HostbasedAuthentication is disabled
  author: Th3l0newolf
  tags: cis,ssh,linux,ssh-audit,ubuntu24.04,benchmark
  metadata:
    cis_section: "5.1.10 Ensure SSH HostbasedAuthentication is disabled"
    cis_level: "Level 1 - Server, Level 1 - Workstation"
    cis_version: "CIS Ubuntu Linux 24.04 LTS Benchmark v1.0.0"
  severity: High
  description: |
    Verifies that HostbasedAuthentication is disabled in sshd_config as per CIS Benchmark. 

self-contained: true

code:
  - engine:
      - bash
    args:
      - "-c"
      - |
        SSHD_CONFIG="/etc/ssh/sshd_config"
        # Check if the parameter is set to yes (bad)
        if grep -i '^\s*HostbasedAuthentication\s\+yes' "$SSHD_CONFIG" >/dev/null; then
          current_value=$(grep -i '^\s*HostbasedAuthentication' "$SSHD_CONFIG" | head -1 | tr -d '\n')
          echo "[cis-ssh-hostbasedauth-disabled:Policy-Fail] [$current_value] [CIS_FAIL] [medium]"
        else
          echo "[cis-ssh-hostbasedauth-disabled:Policy-Pass] [HostbasedAuthentication no or not set] [CIS_PASS] [medium]"
        fi

    matchers:
      - type: word
        words:
          - "Policy-Pass"
        name: policy-pass
      - type: word
        words:
          - "Policy-Fail"
        name: policy-fail
# digest: 4a0a004730450220204eb3fc2decc815606b34b99cd22da89f8b50c3ad6b118bf7ea303d853aa86502210099dc2031fbbc8a0f6ac97d734b4ee71390b06d25f4f1dcdcdb558137e8476887:a335a84a8b55aca14338a3237976ce9a
