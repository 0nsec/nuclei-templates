id: tcpwrapper-access

info:
  name: TCP Wrapper Access Control Check
  author: songyaeji
  severity: low
  description: |
    Checked if IP and port restrictions were properly applied using TCP Wrapper (/etc/hosts.allow and /etc/hosts.deny). Reported systems as vulnerable if unrestricted remote access (e.g. Telnet, RSH, SSH) was possible.
  reference:
    - https://isms.kisa.or.kr
  tags: linux,audit,kisa,compliance

self-contained: true

code:
  - engine:
      - sh
      - bash
    source: |
      echo "[*] Checking /etc/hosts.deny (default deny policy)"
      if grep -Eq "^[[:space:]]*ALL:[[:space:]]*ALL" /etc/hosts.deny; then
        echo "[OK] /etc/hosts.deny has ALL:ALL policy"
      else
        echo "[WARN] /etc/hosts.deny is missing ALL:ALL (default deny)"
      fi

      echo "[*] Checking sshd allow policy in /etc/hosts.allow"
      if grep -Eq "^[[:space:]]*sshd" /etc/hosts.allow; then
        if grep -Eq "^[[:space:]]*sshd:[[:space:]]*ALL" /etc/hosts.allow; then
          echo "[WARN] sshd allows ALL hosts (too permissive)"
        else
          echo "[OK] sshd-specific allow policy found with restrictions"
        fi
      else
        echo "[WARN] No sshd-specific allow policy found"
      fi

      echo "[*] Reminder: TCP Wrappers process /etc/hosts.allow BEFORE /etc/hosts.deny"

    matchers:
      - type: word
        part: response
        words:
          - "/etc/hosts.deny"
          - "/etc/hosts.allow"